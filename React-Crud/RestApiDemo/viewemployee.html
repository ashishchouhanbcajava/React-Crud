<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="empstyle.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="/index.js" defer></script>

    <style>
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        .modal-content {
            background-color: #fefefe;
            margin-bottom: 0px;
            margin: 10% auto;
            /* 10% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            border-radius: 8px;
            width: 80%;
            /* Could be more or less, depending on screen size */
            max-width: 500px;
            /* Limit the max width */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);

        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .container {
            /* margin-top: 60px; */
            max-width: 900px;
            border: 1px solid black;
            border-radius: 6px;
            padding: 20px;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .table-container {
            position: relative;
        }

        .add {
            position: absolute;
            top: -80px;
            right: 0;
            size: 20px;
        }

        .icon {
            font-size: 30px;
        }

        .icon:hover {
            font-size: 30px;
            color: black;
        }

        .edit {
            text-decoration: none;
            color: black;
        }

        .disabled-link {
            pointer-events: none;
            color: lightgray;
            text-decoration: none;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        h2 {
            margin-bottom: 20px;
        }

        .form-control {
            margin-bottom: 15px;
        }

        .btn {
            width: 100%;
        }

        .image-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .image-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
    </style>
</head>

<body>
    <header>

        <nav id="sidebarMenu" class="collapse d-lg-block sidebar collapse bg-white">
            <div class="position-sticky">
                <div class="list-group list-group-flush mx-3 mt-4">
                    <a href="#" class="list-group-item list-group-item-action py-2 ripple" aria-current="true">
                        <i class="fas fa-tachometer-alt fa-fw me-3"></i><span>Main dashboard</span>
                    </a>
                    <a href="AddEmployee.html" class="list-group-item list-group-item-action py-2 ripple ">
                        <i class="fa-sharp fa-solid fa-user-plus me-3"></i><span> Add Employee</span>
                    </a>
                    <a href="viewemployee.html" class="list-group-item list-group-item-action py-2 ripple">
                        <i class="fa-solid fa-list me-4"></i><span>View Employees</span></a>
                    <a href="#" class="list-group-item list-group-item-action py-2 ripple"><i
                            class="fas fa-chart-line fa-fw me-3"></i><span>Analytics</span></a>
                    <a href="#" class="list-group-item list-group-item-action py-2 ripple">
                        <i class="fas fa-chart-pie fa-fw me-3"></i><span>SEO</span>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action py-2 ripple"><i
                            class="fas fa-chart-bar fa-fw me-3"></i><span>Orders</span></a>
                    <a href="#" class="list-group-item list-group-item-action py-2 ripple"><i
                            class="fas fa-globe fa-fw me-3"></i><span>International</span></a>
                    <a href="#" class="list-group-item list-group-item-action py-2 ripple"><i
                            class="fas fa-building fa-fw me-3"></i><span>Partners</span></a>
                    <a href="#" class="list-group-item list-group-item-action py-2 ripple"><i
                            class="fas fa-calendar fa-fw me-3"></i><span>Calendar</span></a>
                    <a href="#" class="list-group-item list-group-item-action py-2 ripple"><i
                            class="fas fa-users fa-fw me-3"></i><span>Users</span></a>
                    <a href="#" class="list-group-item list-group-item-action py-2 ripple"><i
                            class="fas fa-money-bill fa-fw me-3"></i><span>Sales</span></a>
                </div>
            </div>
        </nav>

        <nav id="main-navbar" class="navbar navbar-expand-lg navbar-light bg-white fixed-top">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu"
                    aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-bars"></i>
                </button>


                <a class="navbar-brand" href="#">

                </a>
                <form class="d-none d-md-flex input-group w-auto my-auto">
                    <input autocomplete="off" type="search" class="form-control rounded"
                        placeholder='Search (ctrl + "/" to focus)' style="min-width: 225px" />
                    <span class="input-group-text border-0"><i class="fas fa-search"></i></span>
                </form>


                <ul class="navbar-nav ms-auto d-flex flex-row">

                    <li class="nav-item dropdown">


                        <a class="nav-link me-3 me-lg-0 dropdown-toggle hidden-arrow" href="#"
                            id="navbarDropdownMenuLink" role="button" data-mdb-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-bell"></i>
                            <span class="badge rounded-pill badge-notification bg-danger">1</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <li><a class="dropdown-item" href="#">Some news</a></li>
                            <li><a class="dropdown-item" href="#">Another news</a></li>
                            <li>
                                <a class="dropdown-item" href="#">Something else here</a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link me-3 me-lg-0" href="#">
                            <i class="fas fa-fill-drip"></i>
                        </a>
                    </li>
                    <li class="nav-item me-3 me-lg-0">
                        <a class="nav-link" href="#">
                            <i class="fab fa-github"></i>
                        </a>
                    </li>
                    <li class="nav-item me-3 me-lg-0">
                        <a class="nav-link" href="index.html">
                            <i class="fa-sharp fa-solid fa-house"></i>
                        </a>
                    </li>

                    <li class="nav-item dropdown">

                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li>
                                <a class="dropdown-item" href="#"><i class="united kingdom flag"></i>English
                                    <i class="fa fa-check text-success ms-2"></i></a>
                            </li>
                            <li>
                                <hr class="dropdown-divider" />
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"><i class="poland flag"></i>Polski</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"><i class="china flag"></i>中文</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"><i class="japan flag"></i>日本語</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"><i class="germany flag"></i>Deutsch</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"><i class="france flag"></i>Français</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"><i class="spain flag"></i>Español</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"><i class="russia flag"></i>Русский</a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#"><i class="portugal flag"></i>Português</a>
                            </li>
                        </ul>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle hidden-arrow d-flex align-items-center" href="#"
                            id="navbarDropdownMenuLink" role="button" data-mdb-toggle="dropdown" aria-expanded="false">
                            <img src="https://mdbootstrap.com/img/Photos/Avatars/img (31).jpg" class="rounded-circle"
                                height="22" alt="" loading="lazy" />
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdownMenuLink">
                            <li><a class="dropdown-item" href="#">My profile</a></li>
                            <li><a class="dropdown-item" href="#">Settings</a></li>
                            <li><a class="dropdown-item" href="#">Logout</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </nav>
    </header>


    <main style="margin-top: 60px">
        <div class="container1 pt-4">
            <div class="container">
                <h1 class="text-center text-bold">Employee Details</h1>
                <hr>
                <div class="table-container">
                    <a class="add" th:href="@{/AddUserForm}" title="Add User">
                        <i class="icon bi bi-person-plus-fill"></i>
                    </a>
                    <div class="table-responsive"> <!-- Make the table responsive -->
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col"> Name</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Password</th>
                                    <th scope="col">Designation</th>
                                    <th scope="col">Operation</th>
                                    <th></th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="table">
                                <!-- Table rows will be dynamically inserted here -->
                            </tbody>
                        </table>
                    </div>
                    <div id="updateModal" class="modal">
                        <div class="modal-content">
                            <span class="close" onclick="closeModal()">&times;</span>
                            <h2>Update User</h2>
                            <div class="image-container mb-3">
                                <img src="https://via.placeholder.com/150" alt="Dummy Image" id="updateImage"
                                    class="img-fluid">
                            </div>
                            
                            <form id="updateForm" onsubmit="saveChanges(event)">
                                <input type="hidden" id="updateId">
                                <div class="mb-3">
                                    <label for="updateName" class="form-label">Name:</label>
                                    <input type="text" id="updateName" name="name" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label for="updateEmail" class="form-label">Email:</label>
                                    <input type="email" id="updateEmail" name="email" class="form-control" required>
                                </div>
                                <div class="mb-3">
                                    <label for="updatePassword" class="form-label">Password:</label>
                                    <input type="password" id="updatePassword" name="password" class="form-control"
                                        required>
                                </div>
                                <div class="mb-3">
                                    <label for="updateDesignation" class="form-label">Designation:</label>
                                    <input type="text" id="updateDesignation" name="designation" class="form-control"
                                        required>
                                </div>
                                <button type="submit" class="btn btn-primary">Save</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <script src="./index.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


    <script>


        const viewAll = (() => {
            fetch("http://localhost:8081/api/getAll", {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then((Response) => {
                if (!Response) {
                    console.log("something went wrong")
                }
                return Response.json();
            }).then((data) => {


                // if (!Array.isArray(data)) {
                //     data = [data];
                // }

                // console.log(data);
                // console.log(document.querySelector("#table"));
                let table = document.querySelector("#table")
                table.innerHTML = data.map((user) => {
                    const disable = !user.isChecked ? 'disabled-link' : '';
                    // if (!user.checked) {
                    //     const check = document.querySelectorAll("#edit")
                    //     check.classList.add("btn disabled-link")
                    // }

                    return `
<tr> 


    
<td>${user.id}</td>
<td>${user.name}</td>
<td>${user.email}</td>
<td>${user.password}</td>
<td>${user.designation}</td>
<td><a name="" id="edit" onclick="openModal(event,${user.id})" class="btn ${disable}" href="" role="button"><i class="fa-solid fa-pencil" style="color: #3acb5e;"></i></a></td>
<td><a name="" id="" onclick="deleteEmp(${user.id})" class="btn " href="" role="button"><i class="fa-solid fa-trash-can" style="color: #d24148;"></i></a></td>
<td>
    <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" data-id="${user.id}" onchange="Enable(this)" ${user.isChecked ? 'checked' : ''} >
        </div>
</td>
</tr>`;
                }).join('');

            }).catch((error) => {
                console.log("errorrr" + error);
            })
        })
        document.addEventListener('DOMContentLoaded', function () {
            viewAll(); // Initialize or load data when DOM is fully loaded
        });



        const Enable = ((user) => {
            const check = user.checked;
            const id = user.getAttribute("data-id");
            console.log(check);

            const payload = { id: id, isChecked: check };
            console.log("Payload being sent:", payload);

            fetch(`http://localhost:8081/api/EnabledandDisabled`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(payload)


            }).then((response) => {
                viewAll();
                if (!response.ok) {
                    console.log(response)
                }
                console.log(check)

                return response.text();
            }).then((data) => {
                console.log(data);


            }).catch((error) => {
                console.log(error);

            })



        })



        const openModal = (event, id) => {

            event.preventDefault();
            fetch(`http://localhost:8081/api/emp/${id}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then((response) => {
                    if (!response.ok) {
                        throw new Error("Network response was not ok " + response.statusText);
                    }
                    return response.json();
                })
                .then((user) => {
                    document.querySelector("#updateId").value = user.id;
                    document.querySelector("#updateName").value = user.name;
                    document.querySelector("#updateEmail").value = user.email;
                    document.querySelector("#updatePassword").value = user.password;
                    document.querySelector("#updateDesignation").value = user.designation;
                    // Assuming `user.profilePic` contains the image data in base64 format
                    if (user.profilePic) {
                        document.querySelector("#updateImage").src = `data:image/*;base64,${user.profilePic}`;
                    } else {
                        document.querySelector("#updateImage").src = "https://via.placeholder.com/150"; // Fallback if no image
                    }

                    document.querySelector("#updateModal").style.display = "block";
                })
                .catch((error) => {
                    console.log("error: " + error);
                });
        };
        const closeModal = () => {
            document.querySelector("#updateModal").style.display = "none";

        }


        const deleteEmp = ((id) => {
            // alert(id);
            fetch(`http://localhost:8081/api/delete/${id}`, {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json"
                }
            }).then((response) => {
                if (!response.ok) {
                    return console.log("no user found " + response.statusText);
                }
                viewAll();
            }).catch((error) => {
                console.log(error)
            })
        })


        const saveChanges = ((event) => {
            console.log(document.querySelector("#updatePassword").value);
            
            event.preventDefault();
            const id = document.querySelector("#updateId").value;
            const info = {
                name: document.querySelector("#updateName").value,
                email: document.querySelector("#updateEmail").value,
                password: document.querySelector("#updatePassword").value,
                designation: document.querySelector("#updateDesignation").value,
                department: "Accounts"
            };
            fetch(`http://localhost:8081/api/update/${id}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(info)
            }).then((response) => {
                if (!response.ok) {
                    console.log(response.statusText);

                }
                return response.json();
            }).then(() => {
                closeModal();
                viewAll();

            }).catch((error) => {
                console.log(error);

            })

        })
    </script>

</body>

</html>